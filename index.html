<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gedikli KÃ¶yÃ¼ Dijital BelleÄŸi</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="images/logo.png" alt="Logo" class="sidebar-logo">
            <div class="header-text">
                <h2>Gedikli<br>BelleÄŸi</h2>
            </div>
        </div>

        <nav class="sidebar-menu">
            <button class="menu-btn active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i> Ana Panel
            </button>
            <button class="menu-btn" onclick="showSection('intro')">
                <i class="fas fa-info-circle"></i> KÃ¶y TanÄ±tÄ±mÄ±
            </button>
            <button class="menu-btn" onclick="showSection('market')">
                <i class="fas fa-store"></i> KÃ¶y PazarÄ± <span class="badge">Vitrin</span>
            </button>
            <button class="menu-btn" onclick="showSection('support')">
                <i class="fas fa-headset"></i> Ä°letiÅŸim & Destek
            </button>
            <button class="menu-btn" onclick="showSection('cameras')">
                <i class="fas fa-video"></i> CanlÄ± YayÄ±nlar
            </button>
            <button class="menu-btn" onclick="showSection('genealogy')">
                <i class="fas fa-users"></i> SoyaÄŸacÄ± & NÃ¼fus
            </button>
            <button class="menu-btn" onclick="showSection('archive')">
                <i class="fas fa-box-open"></i> Belge ArÅŸivi
            </button>
            <button class="menu-btn" onclick="showSection('gallery')">
                <i class="fas fa-images"></i> FotoÄŸraf KÃ¼tÃ¼phanesi
            </button>
            <button class="menu-btn" onclick="showSection('memorial')">
                <i class="fas fa-praying-hands"></i> Vefat Edenler
            </button>
            <button class="menu-btn" onclick="showSection('guide')">
                <i class="fas fa-map-marked-alt"></i> KÃ¶y Rehberi
            </button>
        </nav>

        <div class="sidebar-widgets">
            <div class="widget-box weather">
                <div class="widget-icon"><i class="fas fa-cloud-sun"></i></div>
                <div class="widget-info" id="weather-widget-content">
                    <h4>Isparta/Gedikli</h4>
                    <span>YÃ¼kleniyor...</span>
                </div>
            </div>
            <div class="widget-box prayer">
                <div class="widget-icon"><i class="fas fa-mosque"></i></div>
                <div class="widget-info" id="prayer-widget-content">
                    <h4>SÄ±radaki Ezan</h4>
                    <span>HesaplanÄ±yor...</span>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <p>Â© 2025 Gedikli KÃ¶yÃ¼</p>
        </div>
    </aside>

    <main class="main-content">

        <header class="top-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="KÃ¶y kayÄ±tlarÄ±nda arayÄ±n..."
                    oninput="handleGlobalSearch(this.value)">
                <div id="search-results" class="search-results-dropdown"></div>
            </div>

            <div class="user-profile" id="userProfileArea">
                <a href="login.html" class="default-login-link">
                    <span>ZiyaretÃ§i GiriÅŸi</span>
                    <i class="fas fa-user-circle"></i>
                </a>
            </div>
        </header>

        <section id="dashboard" class="page-section active">
            <div class="announcement-banner">
                <div class="announcement-icon">
                    <i class="fas fa-bullhorn"></i> DUYURULAR:
                    <button id="btn-edit-announcements" class="admin-only" onclick="openAnnouncementModal()"
                        style="display:none; background:none; border:none; color:var(--primary); cursor:pointer; margin-left:5px;"
                        title="DuyurularÄ± DÃ¼zenle">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                <div class="announcement-text" style="display: flex; align-items: center; justify-content: center;">
                    <div id="announcement-slider"
                        style="opacity: 1; transition: opacity 0.5s ease-in-out; text-align: center; width: 100%;">
                        YÃ¼kleniyor...
                    </div>
                </div>
            </div>

            <div class="hero-card"
                style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('images/IMG20210814191820.jpg');">
                <h1>Gedikli KÃ¶yÃ¼ Dijital ArÅŸivine HoÅŸ Geldiniz</h1>
                <p>Tarih, KÃ¼ltÃ¼r ve Ä°nsan Hazinesi</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-store" style="color: #f39c12; opacity: 1;"></i>
                    <h3>Pazar</h3>
                    <p>Aktif Ä°lanlar</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-file-alt"></i>
                    <h3>150+</h3>
                    <p>Tarihi Belge</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-camera-retro"></i>
                    <h3>1200+</h3>
                    <p>ArÅŸiv FotoÄŸrafÄ±</p>
                </div>
            </div>
        </section>

        <section id="market" class="page-section">
            <div class="section-header">
                <h2><i class="fas fa-store"></i> Sanal KÃ¶y PazarÄ±</h2>
                <button class="btn-submit idea-btn" onclick="openModal('modal-ad')"><i class="fas fa-plus"></i> Ä°lan
                    Ver</button>
            </div>
            <p style="margin-bottom: 20px; color:#666;">KÃ¶yÃ¼mÃ¼zÃ¼n bereketli topraklarÄ±ndan Ã§Ä±kan Ã¼rÃ¼nler ve satÄ±lÄ±k
                ilanlarÄ±.</p>

            <div class="market-grid">
                <div class="market-card">
                    <div class="market-img">
                        <img src="images/gallery1.jpg" alt="Elma">
                        <span class="price-tag">25 TL / Kg</span>
                    </div>
                    <div class="market-info">
                        <h4>Gedikli ElmasÄ± (DoÄŸal)</h4>
                        <p class="seller"><i class="fas fa-user"></i> SatÄ±cÄ±: Ahmet Amca</p>
                        <p class="desc">Ä°laÃ§sÄ±z, dalÄ±ndan yeni toplanmÄ±ÅŸ, sulu Isparta elmasÄ±.</p>
                        <a href="tel:05555555555" class="btn-call"><i class="fas fa-phone"></i> SatÄ±cÄ±yÄ± Ara</a>
                    </div>
                </div>
                <div class="market-card">
                    <div class="market-img">
                        <img src="images/about.jpg" alt="KÃ¶y ÃœrÃ¼nleri">
                        <span class="price-tag">300 TL / Kg</span>
                    </div>
                    <div class="market-info">
                        <h4>KÃ¶y TereyaÄŸÄ± & Peynir</h4>
                        <p class="seller"><i class="fas fa-user"></i> SatÄ±cÄ±: AyÅŸe Teyze</p>
                        <p class="desc">YayÄ±k tereyaÄŸÄ± ve keÃ§i peyniri. SipariÅŸ Ã¼zerine hazÄ±rlanÄ±r.</p>
                        <a href="tel:05555555555" class="btn-call"><i class="fas fa-phone"></i> SatÄ±cÄ±yÄ± Ara</a>
                    </div>
                </div>
                <div class="market-card">
                    <div class="market-img">
                        <img src="images/IMG20201208100004.jpg" alt="Arsa">
                        <span class="price-tag">Fiyat Sorunuz</span>
                    </div>
                    <div class="market-info">
                        <h4>SatÄ±lÄ±k GÃ¶l ManzaralÄ± Arsa</h4>
                        <p class="seller"><i class="fas fa-user"></i> SatÄ±cÄ±: Mehmet YÄ±lmaz</p>
                        <p class="desc">GÃ¶l kenarÄ±na 500m mesafede, 2 dÃ¶nÃ¼m bahÃ§eli tarla.</p>
                        <a href="tel:05555555555" class="btn-call"><i class="fas fa-phone"></i> SatÄ±cÄ±yÄ± Ara</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="support" class="page-section">
            <div class="section-header">
                <h2><i class="fas fa-headset"></i> Ä°letiÅŸim & Destek</h2>
            </div>

            <div class="support-tabs">
                <button class="support-tab active" onclick="switchSupportTab('fault')">ğŸ› ï¸ ArÄ±za Bildir</button>
                <button class="support-tab" onclick="switchSupportTab('idea')">ğŸ’¡ Ã–neri/Ä°stek</button>
                <button class="support-tab" onclick="switchSupportTab('results')">ğŸ“‹ SonuÃ§lar</button>
                <button class="support-tab admin-only" onclick="switchSupportTab('admin')" style="display:none;">ğŸ“¢ KÃ¶y
                    KÃ¼rsÃ¼sÃ¼</button>
            </div>

            <!-- ARIZA FORMU -->
            <div id="content-fault" class="support-content">
                <div class="support-form-container">
                    <p>Elektrik, su, yol vb. arÄ±zalarÄ± buradan bildirebilirsiniz.</p>
                    <div class="form-group">
                        <textarea id="text-fault" rows="4" placeholder="ArÄ±za detaylarÄ±nÄ± yazÄ±nÄ±z..."></textarea>
                    </div>
                    <button class="btn-submit" onclick="submitTicket('fault')">Bildirimi GÃ¶nder</button>
                </div>
            </div>

            <!-- Ã–NERÄ° FORMU -->
            <div id="content-idea" class="support-content" style="display:none;">
                <div class="support-form-container">
                    <p>KÃ¶yÃ¼mÃ¼z iÃ§in fikir ve Ã¶nerilerinizi bekliyoruz.</p>
                    <div class="form-group">
                        <textarea id="text-idea" rows="4" placeholder="Fikrinizi paylaÅŸÄ±n..."></textarea>
                    </div>
                    <button class="btn-submit idea-btn" onclick="submitTicket('idea')">Fikrimi Ä°let</button>
                </div>
            </div>

            <!-- SONUÃ‡LAR -->
            <div id="content-results" class="support-content" style="display:none;">
                <div id="user-tickets-list">
                    <p style="text-align:center; color:#999; padding:20px;">GÃ¶rÃ¼ntÃ¼lemek iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z.</p>
                </div>
            </div>

            <!-- ADMIN PANEL -->
            <div id="content-admin" class="support-content" style="display:none;">
                <div id="admin-tickets-list">
                    <!-- Tickets will load here -->
                </div>
            </div>
        </section>

        <section id="intro" class="page-section">
            <div class="hero-card"
                style="height: 200px; background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('images/IMG20200807185200.jpg');">
                <h1>ToroslarÄ±n Ä°ncisi: Gedikli</h1>
                <p>CoÄŸrafya, Ä°klim ve YaÅŸam</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>1139m</h3>
                    <p>RakÄ±m</p>
                </div>
                <div class="stat-card">
                    <h3>29 km</h3>
                    <p>Ä°lÃ§e UzaklÄ±ÄŸÄ±</p>
                </div>
                <div class="stat-card">
                    <h3>550+</h3>
                    <p>NÃ¼fus</p>
                </div>
            </div>
            <div class="archive-grid">
                <div class="doc-item" style="text-align: left;">
                    <h3>CoÄŸrafi Konum</h3>
                    <p>Gedikli KÃ¶yÃ¼, Isparta ilinin ÅarkikaraaÄŸaÃ§ ilÃ§esine baÄŸlÄ±dÄ±r.</p>
                </div>
                <div class="doc-item" style="text-align: left;">
                    <h3>Ekonomi</h3>
                    <p>Temel geÃ§im kaynaÄŸÄ± tarÄ±m, hayvancÄ±lÄ±k ve balÄ±kÃ§Ä±lÄ±ktÄ±r.</p>
                </div>
            </div>
        </section>

        <section id="cameras" class="page-section">
            <div class="section-header">
                <h2><i class="fas fa-satellite-dish"></i> CanlÄ± Ä°zleme</h2><span class="solar-info">GÃ¼neÅŸ Enerjili
                    Sistem</span>
            </div>
            <div class="camera-grid">
                <div class="cam-feed">
                    <div class="cam-screen" style="background-image: url('images/IMG20201208100004.jpg');">
                        <div class="cam-overlay"><span class="cam-label">MEYDAN</span><span
                                class="cam-status offline">Ã‡evrimdÄ±ÅŸÄ±</span></div>
                    </div>
                </div>
                <div class="cam-feed">
                    <div class="cam-screen" style="background-image: url('images/IMG20200801163817.jpg');">
                        <div class="cam-overlay"><span class="cam-label">Ä°SKELE</span><span
                                class="cam-status offline">Ã‡evrimdÄ±ÅŸÄ±</span></div>
                    </div>
                </div>
                <div class="cam-feed">
                    <div class="cam-screen" style="background-image: url('images/hero.jpg');">
                        <div class="cam-overlay"><span class="cam-label">SÄ°NDEL</span><span
                                class="cam-status offline">Ã‡evrimdÄ±ÅŸÄ±</span></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="genealogy" class="page-section">
            <div class="section-header">
                <h2>SoyaÄŸacÄ±</h2>
                <button class="btn-add-admin" onclick="openAdminModal('genealogy')" style="display:none;"><i
                        class="fas fa-plus"></i> Ekle</button>
            </div>
            <div class="family-tree-list" id="genealogy-container">
                <!-- Dynamic Content -->
            </div>
        </section>

        <section id="archive" class="page-section">
            <div class="section-header">
                <h2>Belge ArÅŸivi</h2>
                <button class="btn-add-admin" onclick="openAdminModal('documents')" style="display:none;"><i
                        class="fas fa-plus"></i> Ekle</button>
            </div>
            <div class="archive-grid" id="documents-container">
                <!-- Dynamic Content -->
            </div>
        </section>

        <section id="gallery" class="page-section">
            <div class="section-header">
                <h2>FotoÄŸraf KÃ¼tÃ¼phanesi</h2>
                <button class="btn-add-admin" onclick="openAdminModal('gallery')" style="display:none;"><i
                        class="fas fa-plus"></i> Ekle</button>
            </div>
            <div class="masonry-grid" id="gallery-container">
                <!-- Dynamic Content -->
            </div>
        </section>

        <section id="memorial" class="page-section">
            <div class="section-header">
                <h2>Vefat Edenler</h2>
                <button class="btn-add-admin" onclick="openAdminModal('deceased')" style="display:none;"><i
                        class="fas fa-plus"></i> Ekle</button>
            </div>
            <div class="memorial-list" id="deceased-container">
                <!-- Dynamic Content -->
            </div>
        </section>

        <section id="guide" class="page-section">
            <h2>KÃ¶y Rehberi</h2>
            <div class="map-full"><iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12640.67272895697!2d31.3965!3d37.8962!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14c4627000000001%3A0x123456789!2sGedikli%2C%20ÅarkikaraaÄŸaÃ§%2FIsparta!5e0!3m2!1str!2str!4v1600000000000!5m2!1str!2str"
                    width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe></div>
        </section>

    </main>

    <!-- USER PROFILE MODAL -->
    <div id="profileModal" class="modal-overlay" onclick="closeModal('profileModal')">
        <div class="modal-content profile-card" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
            <div class="profile-header">
                <i class="fas fa-user-circle fa-4x" style="color:var(--primary);"></i>
                <h3 id="profileName">KullanÄ±cÄ± AdÄ±</h3>
                <span class="badge" id="profileRole">Yetki</span>
            </div>
            <div class="profile-body">
                <div class="info-row">
                    <strong><i class="fas fa-id-badge"></i> Rol:</strong>
                    <span id="profileRoleDetail">-</span>
                </div>
                <div class="info-row">
                    <strong><i class="fas fa-calendar-alt"></i> KatÄ±lÄ±m:</strong>
                    <span id="profileJoinDate">2024</span>
                </div>
                <div class="info-row">
                    <strong><i class="fas fa-envelope"></i> Ä°letiÅŸim:</strong>
                    <span id="profileContact">-</span>
                </div>

                <hr>

                <div class="profile-actions" style="margin-top:20px; display:flex; gap:10px;">
                    <button class="action-btn" onclick="openChangePasswordModal()"
                        style="background:#3498db; flex:1; border:none; color:white; padding:10px; border-radius:4px; cursor:pointer;"><i
                            class="fas fa-key"></i> Åifre DeÄŸiÅŸtir</button>
                    <button class="action-btn danger" onclick="logout()"
                        style="background:#e74c3c; flex:1; border:none; color:white; padding:10px; border-radius:4px; cursor:pointer;"><i
                            class="fas fa-sign-out-alt"></i> GÃ¼venli Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- CHANGE PASSWORD MODAL -->
    <div id="change-password-modal" class="modal-overlay" onclick="closeModal('change-password-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('change-password-modal')">Ã—</span>
            <h3>Åifre DeÄŸiÅŸtir</h3>
            <form id="changePasswordForm" onsubmit="handleChangePasswordSubmit(event)">
                <div class="form-group">
                    <label>Eski Åifre</label>
                    <input type="password" id="cp-old" style="width:100%; padding:8px; margin-bottom:10px;" required>
                </div>
                <div class="form-group">
                    <label>Yeni Åifre</label>
                    <input type="password" id="cp-new" style="width:100%; padding:8px; margin-bottom:10px;" required>
                </div>
                <div class="form-group">
                    <label>Yeni Åifre (Tekrar)</label>
                    <input type="password" id="cp-confirm" style="width:100%; padding:8px; margin-bottom:10px;"
                        required>
                </div>
                <button type="submit" class="btn-submit" style="background:var(--primary);">GÃ¼ncelle</button>
            </form>
        </div>
    </div>

    <!-- MARKET AD MODAL (Public) -->
    <div id="modal-ad" class="modal-overlay" onclick="closeModal('modal-ad')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('modal-ad')">Ã—</span>
            <h3>Ä°lan Ver</h3>
            <p>Ä°lanlarÄ±nÄ±z muhtarlÄ±k onayÄ±ndan sonra yayÄ±nlanÄ±r.</p>
            <form onsubmit="handleMarketSubmit(event)">
                <div class="form-group"><input type="text" id="mTitle" placeholder="ÃœrÃ¼n AdÄ±" required></div>
                <div class="form-group"><input type="text" id="mPrice" placeholder="Fiyat" required></div>
                <div class="form-group"><input type="text" id="mPhone" placeholder="Telefon NumaranÄ±z" required></div>
                <div class="form-group"><textarea id="mDesc" placeholder="AÃ§Ä±klama" rows="3"></textarea></div>
                <button type="submit" class="btn-submit idea-btn">BaÅŸvuru Yap</button>
            </form>
        </div>
    </div>

    <!-- ADMIN CONTENT MODAL -->
    <div id="admin-modal" class="modal-overlay" onclick="closeModal('admin-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('admin-modal')">Ã—</span>
            <h3 id="adminModalTitle">Ä°Ã§erik Ekle</h3>
            <form id="adminContentForm" onsubmit="handleAdminSubmit(event)">
                <input type="hidden" id="adminContentType">
                <div class="form-group" id="field-title"><label>BaÅŸlÄ±k / Ä°sim</label><input type="text" id="acTitle">
                </div>
                <div class="form-group" id="field-detail"><label>Detay / AÃ§Ä±klama</label><input type="text"
                        id="acDetail"></div>
                <div class="form-group" id="field-date"><label>Tarih / Fiyat</label><input type="text" id="acDate">
                </div>
                <div class="form-group" id="field-image"><label>Resim URL (Opsiyonel)</label><input type="text"
                        id="acImage"></div>

                <button type="submit" class="btn-submit" style="background: var(--primary);">Ekle / GÃ¼ncelle</button>
            </form>
        </div>
    </div>

    <!-- WELCOME MODAL (Otomatik AÃ§Ä±lan) -->
    <div id="welcome-announcement-modal" class="modal-overlay" onclick="closeModal('welcome-announcement-modal')">
        <div class="modal-content" style="max-width: 600px; padding: 40px; text-align: center;"
            onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('welcome-announcement-modal')"
                style="font-size: 2rem;">&times;</span>
            <div style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"><i class="fas fa-bullhorn"></i>
            </div>
            <h2
                style="font-family: 'Playfair Display', serif; font-size: 2rem; margin-bottom: 20px; color: var(--text-main);">
                Ã–nemli Duyurular</h2>
            <div id="welcome-list"
                style="text-align: left; font-size: 1.2rem; line-height: 1.6; color: #444; margin-bottom: 30px;">
                <!-- JS ile doldurulacak -->
                <p>YÃ¼kleniyor...</p>
            </div>
            <button class="btn-submit" onclick="closeModal('welcome-announcement-modal')"
                style="background: var(--primary); font-size: 1.1rem; padding: 12px 40px;">Okudum, TeÅŸekkÃ¼rler</button>
        </div>
    </div>

    <!-- ADMIN ANNOUNCEMENT MODAL -->
    <div id="admin-announcement-modal" class="modal-overlay" onclick="closeModal('admin-announcement-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('admin-announcement-modal')">Ã—</span>
            <h3>DuyurularÄ± DÃ¼zenle</h3>
            <p>DuyurularÄ± tek tek satÄ±r olarak giriniz.</p>
            <form id="adminAnnouncementForm" onsubmit="handleAnnouncementSubmit(event)">
                <div id="announcement-list-container" style="max-height:300px; overflow-y:auto; margin-bottom:15px;">
                    <!-- Javascript will populate this -->
                </div>
                <button type="button" onclick="addAnnouncementInput()"
                    style="background:#f39c12; border:none; color:white; padding:5px 10px; border-radius:4px; margin-bottom:10px; cursor:pointer;">
                    <i class="fas fa-plus"></i> Yeni SatÄ±r Ekle
                </button>
                <button type="submit" class="btn-submit" style="background: var(--primary);">Kaydet ve YayÄ±nla</button>
            </form>
        </div>
    </div>

    <!-- ADMIN REPLY MODAL -->
    <div id="admin-reply-modal" class="modal-overlay" onclick="closeModal('admin-reply-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal('admin-reply-modal')">Ã—</span>
            <h3>YanÄ±t OluÅŸtur</h3>
            <p>VatandaÅŸÄ±n bildirimine yanÄ±tÄ±nÄ±z:</p>
            <form id="adminReplyForm" onsubmit="handleAdminReplySubmit(event)">
                <input type="hidden" id="replyTicketId">
                <div class="form-group">
                    <textarea id="replyText" rows="5" placeholder="YanÄ±tÄ±nÄ±zÄ± buraya yazÄ±nÄ±z..." required></textarea>
                </div>
                <button type="submit" class="btn-submit" style="background: var(--primary);">YanÄ±tÄ± GÃ¶nder &
                    Ã‡Ã¶zÃ¼mle</button>
            </form>
        </div>
    </div>

    <!-- LIGHTBOX MODAL -->
    <div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <img id="lightbox-img" src="" alt="Tam Ekran">
    </div>

    <script src="script.js?v=8"></script>
    <script>
        // CRITICAL FIX: Inline functions to bypass cache issues
        console.log("Inline script loaded - Fixing Admin Reply");

        window.openModal = function (modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                modal.style.visibility = 'visible'; // Force visibility
                modal.style.opacity = '1';         // Force opacity
                document.body.style.overflow = 'hidden';
            } else {
                console.error('Modal not found:', modalId);
            }
        };

        window.closeModal = function (modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                modal.style.visibility = '';
                modal.style.opacity = '';
                document.body.style.overflow = '';
            }
        };

        window.replyToTicket = function (id) {
            console.log("Inline replyToTicket called for ID:", id);
            const idInput = document.getElementById('replyTicketId');
            const textInput = document.getElementById('replyText');

            if (idInput && textInput) {
                idInput.value = id;
                textInput.value = '';
                window.openModal('admin-reply-modal');
            } else {
                alert("Hata: YanÄ±t penceresi elementleri bulunamadÄ±. LÃ¼tfen sayfayÄ± yenileyin.");
            }
        };

        window.handleAdminReplySubmit = async function (e) {
            e.preventDefault();
            const id = document.getElementById('replyTicketId').value;
            const response = document.getElementById('replyText').value;

            if (!response) {
                alert('LÃ¼tfen bir yanÄ±t yazÄ±nÄ±z.');
                return;
            }

            try {
                // Use relative path if on same domain, else full URL
                const API_URL = (window.location.protocol === 'file:' || window.location.hostname === 'localhost')
                    ? 'http://localhost:3000/api'
                    : '/api';

                await fetch(`${API_URL}/tickets/${id}/respond`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ response })
                });

                alert('YanÄ±t baÅŸarÄ±yla gÃ¶nderildi.');
                window.closeModal('admin-reply-modal');
                if (window.loadAdminTickets) window.loadAdminTickets();
                else location.reload(); // Fallback if regular script fails
            } catch (err) {
                console.error(err);
                alert('Ä°ÅŸlem baÅŸarÄ±sÄ±z. Sunucu baÄŸlantÄ±sÄ±nÄ± kontrol edin.');
            }
        };
    </script>
</body>

</html>